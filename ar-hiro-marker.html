<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js - Hiroãƒãƒ¼ã‚«ãƒ¼ AR</title>
    
    <!-- AR.js A-Frameç‰ˆã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #000;
            overflow: hidden;
        }
        
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding: 15px;
            color: white;
        }
        
        .ui-overlay h1 {
            margin: 0 0 10px 0;
            font-size: 20px;
            text-align: center;
        }
        
        .instructions {
            font-size: 14px;
            text-align: center;
            line-height: 1.4;
        }
        
        .marker-info {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding: 15px;
            color: white;
            text-align: center;
        }
        
        .marker-info a {
            color: #00ff88;
            text-decoration: none;
            font-weight: bold;
        }
        
        .marker-info a:hover {
            text-decoration: underline;
        }
        
        .controls {
            position: fixed;
            top: 80px;
            right: 15px;
            z-index: 1000;
        }
        
        .control-btn {
            display: block;
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 25px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: background-color 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 1);
        }
        
        .status {
            position: fixed;
            top: 80px;
            left: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
        }
        
        /* A-Frameã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’éè¡¨ç¤º */
        .a-loader-title {
            display: none !important;
        }
        
        /* ã‚«ãƒ¡ãƒ©æ¨©é™ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤ºèª¿æ•´ */
        .arjs-video {
            object-fit: cover;
        }
    </style>
</head>
<body>
    <!-- UI ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="ui-overlay">
        <h1>ğŸ¯ Hiroãƒãƒ¼ã‚«ãƒ¼ AR</h1>
        <div class="instructions">
            Hiroãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã‚‹ã¨3Dãƒ¢ãƒ‡ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>
    
    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
    <div class="controls">
        <button class="control-btn" onclick="toggleModel()" title="ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆ">ğŸ”„</button>
        <button class="control-btn" onclick="resetCamera()" title="ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆ">ğŸ“·</button>
    </div>
    
    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
    <div class="status" id="status">
        åˆæœŸåŒ–ä¸­...
    </div>
    
    <!-- ãƒãƒ¼ã‚«ãƒ¼æƒ…å ± -->
    <div class="marker-info">
        <p>âœ… <strong>HTTPSå¯¾å¿œ:</strong> npm run dev ã§HTTPSã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ¸ˆã¿</p>
        <p>ğŸ“‹ <a href="./hiro-marker.svg" target="_blank">Hiroãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a> ã—ã¦å°åˆ·ã—ã¦ãã ã•ã„</p>
        <p>ğŸ’¡ ãƒãƒ¼ã‚«ãƒ¼ã‚’å¹³ã‚‰ã«ç½®ãã€ã‚«ãƒ¡ãƒ©ã‚’30cmç¨‹åº¦é›¢ã—ã¦å‘ã‘ã¦ãã ã•ã„</p>
    </div>
    
    <!-- A-Frame ARã‚·ãƒ¼ãƒ³ -->
    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best; maxDetectionRate: 60; canvasWidth: 640; canvasHeight: 480;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;">
        
        <!-- ã‚¢ã‚»ãƒƒãƒˆå®šç¾© -->
        <a-assets>
            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ï¼ˆGLBå¤‰æ›å¾Œã«ä½¿ç”¨ï¼‰ -->
            <a-asset-item id="customModel" src="./custom_model.glb"></a-asset-item>
        </a-assets>
        
        <!-- Hiroãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºæ™‚ã«è¡¨ç¤ºã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ -->
        <a-marker preset="hiro" id="hiroMarker">
            <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å›è»¢ã™ã‚‹ã‚­ãƒ¥ãƒ¼ãƒ– -->
            <a-box 
                id="defaultModel"
                position="0 0.5 0" 
                rotation="0 45 0"
                scale="1 1 1"
                material="color: #ff6b6b; roughness: 0.3; metalness: 0.1;"
                animation="property: rotation; to: 0 405 0; loop: true; dur: 4000; easing: linear;"
                shadow="cast: true; receive: false;">
            </a-box>
            
            <!-- è¿½åŠ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: æµ®éŠã™ã‚‹çƒ -->
            <a-sphere 
                position="1.5 1 0" 
                radius="0.3" 
                material="color: #4ecdc4; emissive: #4ecdc4; emissiveIntensity: 0.2;"
                animation="property: position; to: 1.5 2 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine;">
            </a-sphere>
            
            <!-- å††æŸ± -->
            <a-cylinder 
                position="-1.5 0.75 0" 
                radius="0.3" 
                height="1.5" 
                material="color: #ffe66d; roughness: 0.4;"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 3000; easing: linear;">
            </a-cylinder>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ï¼ˆGLBå¤‰æ›å¾Œã«è¡¨ç¤ºï¼‰ -->
            <a-entity
                id="customModelEntity"
                gltf-model="#customModel"
                position="0 0 1.5"
                scale="0.5 0.5 0.5"
                rotation="0 0 0"
                visible="false"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear;">
            </a-entity>
            
            <!-- åœ°é¢ã®å½± -->
            <a-plane 
                position="0 0 0" 
                rotation="-90 0 0" 
                width="4" 
                height="4" 
                material="color: #333; opacity: 0.3; transparent: true;"
                shadow="receive: true;">
            </a-plane>
            
            <!-- ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º -->
            <a-text 
                value="AR Test Model" 
                position="0 2 0" 
                align="center" 
                color="#ffffff"
                shader="msdf"
                font="dejavu"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 6000; easing: linear;">
            </a-text>
        </a-marker>
        
        <!-- ã‚«ãƒ¡ãƒ©è¨­å®š -->
        <a-entity camera>
            <!-- ç’°å¢ƒå…‰ -->
            <a-light type="ambient" color="#ffffff" intensity="0.4"></a-light>
            <!-- æŒ‡å‘æ€§ãƒ©ã‚¤ãƒˆ -->
            <a-light type="directional" position="1 1 1" color="#ffffff" intensity="0.6" cast-shadow="true"></a-light>
        </a-entity>
    </a-scene>
    
    <script>
        let currentModel = 0;
        const models = ['default', 'custom'];
        const status = document.getElementById('status');
        
        // AR.jsåˆæœŸåŒ–å®Œäº†æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            status.textContent = 'ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–ä¸­...';
            
            // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
            const marker = document.querySelector('#hiroMarker');
            
            marker.addEventListener('markerFound', function() {
                status.textContent = 'âœ… Hiroãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºä¸­';
                console.log('Hiroãƒãƒ¼ã‚«ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ');
            });
            
            marker.addEventListener('markerLost', function() {
                status.textContent = 'ğŸ” ãƒãƒ¼ã‚«ãƒ¼ã‚’æ¢ã—ã¦ã„ã¾ã™...';
                console.log('Hiroãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹å¤±ã‚ã‚Œã¾ã—ãŸ');
            });
        });
        
        // ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–å®Œäº†ã®æ¤œå‡º
        window.addEventListener('camera-init', function() {
            status.textContent = 'ğŸ“¹ ã‚«ãƒ¡ãƒ©æº–å‚™å®Œäº†';
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('arjs-video-loaded', function() {
            status.textContent = 'ğŸ¥ ã‚«ãƒ¡ãƒ©æ˜ åƒèª­ã¿è¾¼ã¿å®Œäº†';
        });
        
        // ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function toggleModel() {
            const defaultModel = document.getElementById('defaultModel');
            const customModelEntity = document.getElementById('customModelEntity');
            
            currentModel = (currentModel + 1) % models.length;
            
            if (models[currentModel] === 'default') {
                defaultModel.setAttribute('visible', 'true');
                customModelEntity.setAttribute('visible', 'false');
                status.textContent = 'ğŸ² ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºä¸­';
            } else {
                defaultModel.setAttribute('visible', 'false');
                customModelEntity.setAttribute('visible', 'true');
                status.textContent = 'ğŸ­ ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºä¸­';
            }
        }
        
        // ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetCamera() {
            // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚«ãƒ¡ãƒ©ã‚’ãƒªã‚»ãƒƒãƒˆ
            window.location.reload();
        }
        
        // ã‚¨ãƒ©ãƒ¼å‡¦ç†
        window.addEventListener('error', function(e) {
            status.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
            console.error('AR.jsã‚¨ãƒ©ãƒ¼:', e);
        });
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
        setInterval(function() {
            const fps = document.querySelector('a-scene').systems.fps;
            if (fps && fps.fps < 20) {
                console.warn('FPSä½ä¸‹æ¤œå‡º:', fps.fps);
            }
        }, 5000);
    </script>
    
    <!-- æŠ€è¡“ä»•æ§˜ã¨ä½¿ç”¨æ–¹æ³•ã®ã‚³ãƒ¡ãƒ³ãƒˆ -->
    <!--
    âš ï¸ é‡è¦: HTTPSç’°å¢ƒãŒå¿…é ˆã§ã™ âš ï¸
    
    ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯HTTPSæ¥ç¶šãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®æ–¹æ³•ã§HTTPSã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ãã ã•ã„:
    
    æ–¹æ³•1: Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆæ¨å¥¨ï¼‰
    1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
       npm install
       npm run dev
    2. è‡ªå‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã€HTTPSã§èµ·å‹•ã—ã¾ã™
    3. è‡ªå·±è¨¼æ˜æ›¸ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€Œè©³ç´°è¨­å®šã€â†’ã€Œå®‰å…¨ã§ã¯ãªã„ã‚µã‚¤ãƒˆã«ç§»å‹•ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
    
    æ–¹æ³•2: Live Serverï¼ˆVSCodeæ‹¡å¼µï¼‰
    1. VSCodeã§Live Serveræ‹¡å¼µã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    2. HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ "Open with Live Server"
    
    æ–¹æ³•3: Node.js https-server
    1. npm install -g http-server
    2. http-server -S -p 8080
    
    Hiroãƒãƒ¼ã‚«ãƒ¼ ARå®Ÿè£…ã®æŠ€è¡“ä»•æ§˜:
    
    ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:
    - A-Frame 1.4.0: WebVRãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
    - AR.js: WebARãƒ©ã‚¤ãƒ–ãƒ©ãƒª
    
    ãƒãƒ¼ã‚«ãƒ¼ä»•æ§˜:
    - preset="hiro": æ¨™æº–çš„ãªHiroãƒãƒ¼ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³
    - æ¤œå‡ºè·é›¢: 10cmã€œ100cmç¨‹åº¦
    - æ¨å¥¨å°åˆ·ã‚µã‚¤ã‚º: 5cmÃ—5cmä»¥ä¸Š
    
    3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:
    - Box: å›è»¢ã™ã‚‹ã‚­ãƒ¥ãƒ¼ãƒ–ï¼ˆãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
    - Sphere: æµ®éŠã™ã‚‹çƒä½“
    - Cylinder: å›è»¢ã™ã‚‹å††æŸ±
    - Text: 3Dãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
    - Custom Model: GLBå½¢å¼ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«
    
    ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½:
    - ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
    - ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
    - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹è¡¨ç¤º
    
    æœ€é©åŒ–è¨­å®š:
    - maxDetectionRate: 60fps
    - canvasè§£åƒåº¦: 640x480
    - trackingMethod: bestï¼ˆæœ€é«˜å“è³ªï¼‰
    
    ä½¿ç”¨æ–¹æ³•:
    1. HTTPSã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆä¸Šè¨˜å‚ç…§ï¼‰
    2. Hiroãƒãƒ¼ã‚«ãƒ¼ã‚’å°åˆ·
    3. ãƒãƒ¼ã‚«ãƒ¼ã‚’å¹³é¢ã«é…ç½®
    4. ã‚«ãƒ¡ãƒ©ã‚’30cmç¨‹åº¦é›¢ã—ã¦å‘ã‘ã‚‹
    5. 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
    -->
</body>
</html>